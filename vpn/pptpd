sudo apt-get install pptpd 


这里说下ubuntu下安装配置pptpd。首先安装pptpd这个VPN服务器软件，ssh连接登录后用下面这个命令：
sudo apt-get install pptpd

安装好了在webmin的网络这一栏里就可以看到pptp vpn server这项了。

安装完了需要对相关文件进行配置修改，用webmin上的文件管理或ssh端用vi命令修改都行。

第一步：

方法一：ssh连接修改/etc/pptpd.conf这个文件

vi /etc/pptpd.conf

找到#localip 192.168.0.1和#remoteip 192.168.0.234-238,192.168.0.245这两行，把前面的#号去掉，然后保存就行了。

这里，localip 是 VPN 链接成功后服务器的 ip 地址， remoteip 则客户端的可分配 ip 地址范围。下面是我的配置：

# (Recommended)

localip 192.168.0.1

remoteip 192.168.0.234-238,192.168.0.245

# or

#localip 192.168.0.234-238,192.168.0.245

#localip 192.168.0.234-238,192.168.0.245

#remoteip 192.168.1.234-238,192.168.1.245


第二步：

然后再要编辑/etc/ppp/pptpd-options这个文件,为vpn指定DNS服务器, 你可以找到你服务器用的DNS服务器地址，或者直接使用Google Public DNS：

vi /etc/ppp/pptpd-options

找到ms-dns这项，去掉前面的#号，修改成google提供的DNS，很好记哈

ms-dns 8.8.8.8

ms-dns 8.8.4.4

修改好后保存。

第三步：

接下来建立vpn账号和密码了，可以直接在webmin的pptp vpn server选项里修改，修改文件也行。

修改/etc/ppp/chap-secrets文件，按一行四列添加账号、服务器名、密码和IP限制。即第一列是用户名，第二列是服务器名（默认写pptpd 即可，注意与 pptpd-options 文件保持一致）
，第三列是密码，第四列是 IP 限制（不做限制用 * ）。如创建一个名为test，密码为123，不限制登录IP的VPN账号：
test pptpd 123 *

修改好后保存行了。

最后重启pptpd服务，就可以生效了。

到了这一步，正常的话在XP里建立个VPN连接应该可以连接上了，但还不能访问外网，还需要另外的配置。但是如果连接不上VPN服务器的话，那就是碰上传说中的人品问题了，我就碰到过，明明所有步骤都做了，但是就是不能连接上，然后就胡乱折腾，看运气什么时候能折腾好了。

继续下一步，第四步：

修改/etc/sysctl.conf 这个文件，把ipv4 forward开启，方法是找到/etc/sysctl.conf这个文件里的这一行#net.ipv4.ip_forward=1后，去掉net.ipv4.ip_forward=1前面的#号，使他生效，然后保存，运行命令sysctl –p.

root@s:~# sysctl -p

运行命令后会显示这样的一行，那就表示修改生效了。

net.ipv4.ip_forward = 1

这样，vpn 服务器就算是搭建成功了。

重启pptpd后如果还不能访问外网，那么就要再来一步。

第五步：

使用iptables建立一个NAT, 用下面的命令：

apt-get install iptables （如果已经安装iptables，这一步就不用了）

iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth0 -j MASQUERADE

上面的24表示子网掩码，代表24个1.

OK，到了这一步就应该可以用VPN了哈。如果不能，我也不知是哪里出问题了。

如果要防止重启服务器后iptables丢失，先运行

iptables-save > /etc/iptables-rules

然后修改/etc/network/interfaces 文件，在eth0 下面加入

pre-up iptables-restore < /etc/iptables-rules

这样，服务器重启后，就能自动挂载规则了。
